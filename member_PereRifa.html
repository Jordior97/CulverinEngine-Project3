<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Njoy Games Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Njoy Games website" />
    <meta name="author" content="Daniel Triviño Merida" />

    <!-- css -->
    <link href="https://fonts.googleapis.com/css?family=Handlee|Open+Sans:300,400,600,700,800" rel="stylesheet">
    <link href="css/bootstrap.css" rel="stylesheet" />
    <link href="css/bootstrap-responsive.css" rel="stylesheet" />
    <link href="css/flexslider.css" rel="stylesheet" />
    <link href="css/prettyPhoto.css" rel="stylesheet" />
    <link href="css/camera.css" rel="stylesheet" />
    <link href="css/jquery.bxslider.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />

    <!-- Colors CSS -->
    <link href="css/default.css" rel="stylesheet" />

</head>

<body>

<div id="wrapper">

    <!-- start header -->
    <header>
        <div class="top">
            <div class="container">
                <div class="row"></div>
            </div>
        </div>
        <div class="container">

            <div class="row nomargin">
                <div class="span4">
                    <div class="logo">
                        <a href="index.html"><img style="width: 130px; height: 75px;" src="img/logo.png" alt="" /></a>
                    </div>
                </div>
                <div class="span8">
                    <div class="navbar navbar-static-top">
                        <div class="navigation">
                            <nav>
                                <ul class="nav topnav">
                                    <li>
                                        <a href="index.html"><i class="fa fa-home"></i> Home </a>
                                    </li>
                                    <li>
                                        <a href="versions.html"><i class="fa fa-download"></i> Releases </a>
                                    </li>
                                    <li class="active">
                                        <a href="team.html"><i class="fa fa-user"></i> Team </a>
                                    </li>
                                    <li>
                                        <a href="gallery.html"><i class="fa fa-picture-o"></i> Gallery </a>
                                    </li>
                                    <li>
                                        <a href="post_mortem.html"><i class="fa fa-file-text-o"></i> Post Mortem </a>
                                    </li>
                                    <li>
                                        <a href="contact.html"><i class="fa fa-envelope-o"></i> Contact </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        <!-- end navigation -->
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- end header -->


    <!-- ################################################################################################################ -->
    <!-- #####################################       DESDE AQUI       ################################################### -->
    <!-- ################################################################################################################ -->


    <section id="inner-headline">
        <div class="container">
            <div class="row">
                <div class="span8">
                    <div class="inner-heading">
                        <!-- ###################################################################### -->
                        <!-- TODO1: Cambiar "Member Name" y "Member Role Name" por tus datos reales -->
                        <!--        Si abris este archivo html con el navegador podreis ir viendo   -->
                        <!--        el resultado.                                                   -->
                        <!-- ###################################################################### -->
                        <h2>Pere Rifà Planellas</h2>
                        </br>
                        <h5>Programmer</h5>
                        <!-- ##### END TODO1 ##### -->
                        <!-- ###################################################################### -->
                        <!-- TODO2: Cambiar la almohadilla (#) de los href por el enlace que        -->
                        <!--       corresponda. Ejemplo: href="https://github.com/dibu13"           -->
                        <!--       Las redes que no querais poner borrais la linea entera.          -->
                        <!-- ###################################################################### -->

                        <a href="https://github.com/PereRifa" class="btn btn-social-icon btn-github" target="_blank"><i class="fa fa-github"></i></a>
                        <a href="https://www.linkedin.com/in/pere-rif%C3%A0-planellas-798613108/" class="btn btn-social-icon btn-linkedin" target="_blank"><i class="fa fa-linkedin"></i></a>
                        <a href="https://twitter.com/prifaplanellas" class="btn btn-social-icon btn-twitter" target="_blank"><i class="fa fa-twitter"></i></a>
                        <!-- ##### END TODO2 ##### -->

                    </div>
                </div>
                <div class="span4">
                    <!-- ###################################################################### -->
                    <!-- TODO3: Copiar la imagen de tu cara a la carpeta img/avatar             -->
                    <!--       Modificar "defaultAvatar.jpg" del src con el nombre exacto del   -->
                    <!--       archivo anterior. Ejemplo: src="img/avatar/MiCara.png"           -->
                    <!--             ¡¡¡NO DEBEN PESAR MAS DE 100 - 150 KB !!!                  -->
                    <!--             Ponle un nombre que sepas que no lo va a poner nadie.      -->
                    <!-- ###################################################################### -->
                    <img class="thumbnail floatright" style="max-height: 300px;max-width: 300px;" src="img/avatar/PereRifa_profile.jpg" alt="" />
                    <!-- ##### END TODO3 ##### -->

                </div>
            </div>
        </div>
    </section>

    <section id="content">
        <div class="container">

            <!-- ###################################################################### -->
            <!-- TODO4: Utilizando las estructuras que estan a continuacion montar      -->
            <!--       el contenido de tu pagina personal. Copias el trozo que quieras  -->
            <!--       lo pegas las veces que quieras y modificas el contenido de los   -->
            <!--       <H4> los <p> y las src de las imagenes. Las imagenes que querais -->
            <!--       poner hay que copiarlas dentro de la carpeta "img/member-images".-->
            <!--       Las imagenes deben pesar entre 500KB y 1MB.                      -->
            <!--       Usa algun prefijo o algo para que los nombres de tus imagenes no -->
            <!--       se repitan con las de los demas al subirlas. Por ejemplo:        -->
            <!--       "tuNombre_nombreImagen.png".                                     -->
            <!--       Pueden ser .jpg, .png o .gif                                     -->
            <!--                                                                        -->
            <!--       Si en alguna de las estructuras quereis añadir otro elemento     -->
            <!--       como otro parrafo solo hay que copiar la <p></p> y pegarlo       -->
            <!--       debajo del otro. Si os veis, podeis combinar los elementos.      -->
            <!--                                                                        -->
            <!--       Si quereis usar una estructura sin el titulo teneis que borrar   -->
            <!--       lo siguiente:  <div class="row">                                 -->
            <!--                          <div class="span12">                          -->
            <!--                              <h4>Title only text</h4>                  -->
            <!--                          </div>                                        -->
            <!--                      </div>                                            -->
            <!--       Al acabar solo dejad las que usais.                              -->
            <!-- ###################################################################### -->
            <!-- @@@@@@@@@@ ESTRUCTURA 1: Solo texto @@@@@@@@@@ -->
            <div class="row">
                <div class="span12">
                    <h4>My Job</h4>
                </div>
            </div>
            <div class="row">
                <div class="span12">
                    <p>
                        As a programmer, most of my work has been aimed at improving the engine and it's performance, help other coworkers with physics, develop tasks
                        in the Stage and Puzzle scrum and lend a hand to Combat and UI scrums.
                    </p>
                </div>
            </div>

            <h4>
                What I have been doing?
            </h4>
            <div class="row">
                <div class="span12">
                    <p>
                        In the firsts steps of the project, i have spent my time implementing our physics system based on nvidia PhysX lib and adding new features to
                        fulfill the needs of the team. I also have been taken part in the development of two puzzles, the barrels puzzle and the pressure plates puzzle.
                        I have helped other scrums like the combat one adding physics to the projectiles, weapons and enemies, leting them interact and spawn particle
                        systems with desired collisions or the UI scrum creating a system to resize UI using anchor points.

                    </p>
                    <p>
                        Finally, due to low engine performance, I have worked hard to improve it, mainly upgrading gameobjects culling and removing leaks.
                    </p>
                </div>
            </div>
            <!-- @@@@@@@@@@ END ESTRUCTURA 1 @@@@@@@@@@ -->
            <!-- <div class="row">-->

            <h6>Implemented Features:</h6>

            <!-- </div>-->

            <a href="#engine" style="color:blue">Engine</a>
            <ul>
                <li><a href="#physics" style="color:blue">Physics</a></li>
                <li><a href="#transform" style="color:blue">Component Transform</a></li>
                <li><a href="#uiresize" style="color:blue">UI Resize & Anchor Points</a></li>
                <li><a href="#multiscenes" style="color:blue">Load MultiScenes</a></li>
                <li><a href="#deletions" style="color:blue">GameObjects Deletion</a></li>
                <li><a href="#leaks" style="color:blue">Memory Usage</a></li>
                <li><a href="#performance" style="color:blue">Improve Performance</a></li>
                <li><a href="#culling" style="color:blue">Oclusion Culling</a></li>
            </ul>
            <a href="#ingame" style="color:blue">In-Game</a>
            <ul>
                <li><a href="#puzzle1" style="color:blue">Barrel Puzzle</a></li>
                <li><a href="#puzzle2" style="color:blue">Pressure Plates Puzzle</a></li>
                <li><a href="#combat" style="color:blue">Combat with Physics</a></li>
                <li><a href="#lever" style="color:blue">Levers</a></li>
            </ul>

            <!-- @@@@@@@@@@ ESTRUCTURA 2: Linea separadora @@@@@@@@@@ -->
            <div class="row">
                <div class="span12">
                    <div class="solidline"></div>
                </div>
            </div>

            <a name="engine"></a>
            <h4>Engine Features:</h4>

            <a name="physics"></a>
            <h6>Physics:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        In collaboration with Joan Pareja, we have added a new module to handle physics simulation. Starting from nvidia PhysX lib as base we have done an
                        abstraction layer to integrate physics within the engine. Due to the low requeriments of the game, only basic functionality has been added. The
                        initial elements has been: component collider, component rigidbody and component joint.
                    </p>
                    <p>
                        From that point, I have taken care of physics in the engine and I have added new features and functionality to match the needs of the project.
                    </p>
                </div>
                <div class="span4">
                    <p>
                        Features added:
                    </p>
                    <ul>
                        <li>Trigger and Contact collision callbacks</li>
                        <li>Continer for Contact point data</li>
                        <li>FilterShader to detect collisions using gameobjects taggs</li>
                    </ul>
                    <p>
                        Scripting Features:
                    </p>
                    <ul>
                        <li>OnTriggerEnter, OnTriggerLost, OnContact</li>
                        <li>Lock and Unlock motion/rotation</li>
                        <li>Apply Liniar and Angular force/impulse</li>
                        <li>Move Kinematic and static colliders</li>
                        <li>Enable/Disable colliders</li>
                        <li>Physics Raycast that return the gameobject</li>
                    </ul>
                </div>
                <div class="span4">
                    <img class="thumbnail" style="max-height: 300px;max-width: 300px; margin: 0 auto;" src="img/member-images/PereRifa_physx.png" alt="" />
                </div>
                <div class="span4">
                    <img class="thumbnail" style="max-height: 358px;max-width: 358px; margin: 0 auto;" src="img/member-images/PereRifa_contact.gif" alt="" />
                </div>
            </div>

            <a name="transform"></a>
            <h6>Component Transform:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        I have refactored the component transformation to improve its performance and add some functionalities. The most relevant is the possibility to edit
                        transformations in two diferent ways: Local or World transform. The last one, first update the global transform and then calculate the local.
                    </p>
                    <p>
                        Related to In-Game transformations, scripting can modify both transformations and use extra functions added like: SetForwardVector, SetUpVector or
                        SetRightVector.
                    </p>
                </div>
                <div class="span12">
                    <img class="thumbnail" style="max-height: 500px;max-width: 500px; margin: 0 auto;" src="img/member-images/PereRifa_worldtransform.gif" alt="" />
                </div>
            </div>

            <a name="uiresize"></a>
            <h6>UI Resize & Anchor Points:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        My coworkers in the UI scrum have had problems when considering how to use anchor points and then rescale the UI, so i have volunteered to face that task.
                        To solve that task I have done the anchor poits and the option to rescale using uniform scale to keep textures proportions or adapt elements to screen scale.
                    </p>
                </div>
                <div class="span12">
                    <img class="thumbnail" style="max-height: 500px;max-width: 500px; margin: 0 auto;" src="img/member-images/PereRifa_resize.gif" alt="" />
                </div>
            </div>

            <a name="multiscenes"></a>
            <h6>Load MultiScenes:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        The engine should be able to handle multiple scenes at the same time, for example, the level and the pause menu. The reason for this was to have two scenes,
                        the primary and the secondary, and switch between them realy fast. Only the primary scene needs to be update and recive input events.
                    </p>
                    <p>
                        To load multiple scenes at the same time I have taken as reference the work done by Eliot Jimenez this system can load a scene in a secondary plane and keep
                        the current scene until next one is loaded.
                    </p>
                </div>
                <div class="span12">
                    <img class="thumbnail" style="max-height: 300px;max-width: 300px; margin: 0 auto;" src="img/member-images/PereRifa_multiscene.gif" alt="" />
                </div>
            </div>

            <a name="deletions"></a>
            <h6>GameObjects Deletion:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        In the first half of the project, we have had a lot of bugs and random crashes due to objects deletions. Later on i have solved this problem refactoring scene
                        clean up, gameobject deletions and reference removal from scripting system.
                    </p>
                </div>
            </div>

            <a name="leaks"></a>
            <h6>Memory Usage:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        Since the work had to be done and the time was limited, some things have been skiped, one of them is the efficient managment of memory. In the late stage of the
                        project we have realized that due to that we have had many memory leaks. Using deleaker as a main tool i have identified the most relevant leaks that might affect
                        gameplay and I have removed them.
                    </p>
                    <p>
                        Along this task, the leaks has been reduced by 75%. The remaining 25% of leaks are due to the engine itself, this leaks are small in size and hard to solve without
                        getting involved in a huge patch, so we have decided to let them be.
                    </p>
                </div>
            </div>

            <a name="performance"></a>
            <h6>Improve Performance:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        At the last milestons of the project, we have realized that the overall performance in-game was rather low, so a few coworkers from the Stage scrum, the lead
                        Programmer and I have tried to solve it. One of the major problems has been the render of the lights and the huge amount of gameobjects in each level. Since I
                        didn't know how the shaders and lights worked i have tried a different aproach to reduce the compsumption.
                    </p>
                    <p>
                        Until that moment, we were using Octree as a Camera culling tool but due to the game being a tile based game with lots of gameobjects in every tile the process to
                        collect candidates was realy slow. We have tried to reduce this time by switching the way we iterate through the hierachy, on the other hand I also have modifyed
                        the alorithm to check if the bounding boxes were inside the frustum, but with both improvements the result has been of about 15% less time (1 ms). The results of
                        this improvements have not been good enough for our goals.
                    </p>
                    <p>
                        After that I have tried to filter the dynamic objects, which at that point of the projecte were always drawn, using a faster aproximation of camera culling, with
                        this improvement the dynamic gameobjects drawn have been reduced about 60-80%. Even with that, the performance remained low so we kept thinking a way to improve it
                        even further.
                    </p>
                    <p>
                        The best option we have found is to use a grid based collect candidates, I have implemented this grid based culling and the results has been quite amaizing since
                        the time requered to collect candidates has been less than 5% of the previous time.
                    </p>
                </div>
                <div class="span12">
                    <img class="thumbnail" style="max-height: 500px;max-width: 600px; margin: 0 auto;" src="img/member-images/PereRifa_culling.png" alt="" />
                </div>
            </div>

            <a name="culling"></a>
            <h6>Oclusion Culling:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        One of the best things of 2D grid culling in a tile based videogame is that we can oclude tiles in a easy way and win even more performance by reducing the amount
                        of GameObjects drawn.
                    </p>
                    <p>
                        So that is what i have done, Elliot Jimenez have created a tool to edit oclusion maps, with the help of this tool I have done the frustum Oclusion culling to oclude
                        tiles and skip the need to check and draw the gameobjects within them.
                    </p>
                    <p>
                        In the next photo, which is a screenshot of the smallest scene without some walls to see through, before the Oclusion Camera Culling is done, 456 GameObjects have
                        been drawn. After the Oclusion culling only 72 of them have remained, this diference of 384 objects has helped us to reduce the render time.
                    </p>

                    <div class="span6">
                        <img class="thumbnail" style="max-height: 410px;max-width: 410px; margin: 0 auto;" src="img/member-images/PereRifa_noculling.png" alt="" />
                    </div>

                    <div class="span4">
                        <img class="thumbnail" style="max-height: 400px;max-width: 400px; margin: 0 auto;" src="img/member-images/PereRifa_oclusiongif.gif" alt="" />
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="span12">
                    <div class="solidline"></div>
                </div>
            </div>

            <a name="ingame"></a>
            <h4>In-Game Features:</h4>

            <a name="puzzle1"></a>
            <h6>Barrel Puzzle:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        This has been the first big puzzle made by our scrum. In the first iteration of barrel puzzle we have used physics to detect collision and make the barrel fall down. I have
                        added joint component to the engine and I have used it to connect the chain and the barrel. When the player interacts with the barrel collider (shot or attack) the joint is
                        destroyed and falls down building a floating path above the valyrian pool. I have implemented Physics mechanism and the scripts to detect collisions to make the barrels fall
                        down.
                    </p>
                    <p>
                        After that, first I have fixed some issues related to the generation of paths to cross the pool, and then I have added a lever to start the puzzle and chains which are moved
                        in a synchronized loop with the barrels.
                    </p>
                    <p>
                        At the end, we have had to remove the physics due to lack of sense of applying physics to our puzzle and the negative impact of the low engine performance which makes the
                        physics behave wrong.
                    </p>
                </div>
                <div class="span12">
                    <img class="thumbnail" style="max-height: 500px;max-width: 600px; margin: 0 auto;" src="img/member-images/PereRifa_PuzzleBarrels.gif" alt="" />
                </div>
            </div>

            <a name="puzzle2"></a>
            <h6>Pressure Plates Puzzle:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        The pressure plates puzzle have been proposed in the last half of the project because at that moment the engine had improved enough, we could split the work in smaller teams.
                        My task have been the development of this puzzle which consists of a follow-up of pressure plates that modify the way forward. The player must proceed through a room full of
                        obstacles and pressure plates until reach the exit.
                    </p>
                </div>
                <div class="span12">
                    <img class="thumbnail" style="max-height: 500px;max-width: 600px; margin: 0 auto;" src="img/member-images/PereRifa_PressurePuzzle.gif" alt="" />
                </div>
            </div>

            <a name="combat"></a>
            <h6>Combat with Physics:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        Being a videogame where the characters have different weapons, some of them range weapons, we had realized that the physics would have a very important role around the player.
                        Therefore, from the beginning I have been helping the player scrum with character's attacks and interactions.
                    </p>
                    <p>
                        Among the needs that had been raised was to shoot projectiles and detect collisions with obstacles or enemies. I have made the script to shoot arrows and fireballs, also the one
                        to destroy the projectile after collision, and then create a particle system in the point of impact and apply damage if the projectile clashed against an enemy. The mele combat
                        uses a combination of raycast and dynamic collider to attack with the sword. If an attack lands on an enemy, particle systems emulating blood spatter are created at different
                        collision points with every slash.
                    </p>
                </div>
            </div>

            <a name="lever"></a>
            <h6>Levers:</h6>
            <div class="row">
                <div class="span12">
                    <p>
                        Levers are used almost in every level as a mechanism to open doors or start puzzles. As the lever collider triggers the player, the ui button to interact with, appears, when
                        interaction happens the animation starts and finally the linked functionality goes into action.
                    </p>
                </div>
                <div class="span12">
                    <img class="thumbnail" style="max-height: 500px;max-width: 500px; margin: 0 auto;" src="img/member-images/PereRifa_lever1.gif" alt="" />
                </div>
            </div>
            <div class="row">
                <div class="span12">
                    <div class="solidline"></div>
                </div>
            </div>

            <div class="blankline30"></div>
        </div>
    </section>


    <footer>
        <div class="container">
            <div class="row">
                <div class="span4">
                    <div class="widget">
                        <h5 class="widgetheading">Social media</h5>
                        <a href="https://www.facebook.com/NjoyGames-2060362217554288/" class="btn btn-social-icon btn-facebook" target="_blank"><i class="fa fa-facebook"></i></a>
                        <a href="https://www.instagram.com/njoygames/" class="btn btn-social-icon btn-instagram" target="_blank"><i class="fa fa-instagram"></i></a>
                        <a href="https://twitter.com/njoy_games" class="btn btn-social-icon btn-twitter" target="_blank"><i class="fa fa-twitter"></i></a>
                    </div>
                </div>
                <div class="span4">
                    <div class="widget">
                        <h5 class="widgetheading">Get in touch</h5>
                        <address>
                            <strong>Njoy Games</strong><br>
                            C/ de la Igualtat 33<br>
                            08222 Terrassa, Barcelona
                        </address>
                        <p>
                            <i class="fa fa-envelope-o"></i> <a href="mailto:njoygames0@gmail.com" target="_top">njoygames0@gmail.com</a>
                        </p>
                    </div>
                </div>
                <div class="span4">
                    <div class="widget">
                        <h5 class="widgetheading">Repository</h5>
                        <p>
                            Keep updated for new releases or see the code.
                        </p>
                        <a href="https://github.com/Project3CITM/CulverinEngine-Project3" class="btn btn-social-icon btn-github" target="_blank"><i class="fa fa-github"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <div id="sub-footer">
            <div class="container">
                <div class="row">
                    <div class="span6">
                        <div class="copyright">
                            <p><span>&copy; Njoy Games. All right reserved</span></p>
                        </div>
                    </div>
                    <div class="span6">
                        <div class="credits">
                            Designed by <a href="https://www.linkedin.com/in/danieltriviñomerida/" target="_blank">dibu13</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</div>

<a href="#" class="scrollup"><i class="icon-square icon-bglight icon-2x active fa fa-angle-up fa-2x"></i></a>

<!-- javascript
  ================================================== -->
<script src="js/jquery.js"></script>
<script src="js/jquery.easing.1.3.js"></script>
<script src="js/bootstrap.js"></script>

<script src="js/modernizr.custom.js"></script>
<script src="js/toucheffects.js"></script>
<script src="js/google-code-prettify/prettify.js"></script>
<script src="js/jquery.bxslider.min.js"></script>

<script src="js/jquery.prettyPhoto.js"></script>
<script src="js/portfolio/jquery.quicksand.js"></script>
<script src="js/portfolio/setting.js"></script>

<script src="js/jquery.flexslider.js"></script>
<script src="js/animate.js"></script>
<script src="js/inview.js"></script>

<script src="js/custom.js"></script>


</body>

</html>
